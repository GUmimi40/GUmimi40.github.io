{"version":3,"sources":["scripts/views/storydetail/index.js","utils/history.js","utils/axios.js","scripts/mobx/index.js"],"names":["alert","Modal","showAlert","text","onPress","console","log","style","history","push","StoryDetail","goback","sessionStorage","storytype","state","detail","article_category","go","showXinyuan","goXinyuan","xunyuansub","likeStory","id","count","userPhone","like_users","setState","axios","post","phoneArr","then","res","toggle","cancelLikeStory","arr","ind","indexOf","splice","starStory","stories","userstarstory","phone","storyArr","star","cancelStarStory","storyid","author","scrollTo","this","data","result","author_object","like_user","get","params","className","onClick","src","picture_url","substring","alt","first_name","localized_article_location","published_at_human_readable","cover_image_url","title","email_subtitle","_id","like_count","background","color","Component","createHashHistory","defaults","baseURL","headers","common","interceptors","request","use","config","token","error","Promise","reject","response","setTimeout","msg","code","Msgtoggle","observable","action","msgtoggle"],"mappings":"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","file":"static/js/13.b5ad014a.chunk.js","sourcesContent":["\r\nimport \"./index.scss\";\r\nimport {history} from \"&/history\";\r\nimport {axios} from \"&/axios\";\r\nconst alert = Modal.alert;\r\nimport { Modal } from 'antd-mobile';\r\nimport Msgtoggle from \"../../mobx\";\r\nconst showAlert = () => {\r\n    const alertInstance = alert('您还没有登录', '是否前往登录页面', [\r\n      { text: '继续浏览', onPress: () => console.log('未登录'), style: 'default' },\r\n      { text: '前往登录', onPress: () => history.push(\"/login\") },\r\n    ]);\r\n};\r\n\r\nexport default class StoryDetail extends Component{\r\n    constructor(){\r\n        super();\r\n        this.state = {\r\n            storyid: sessionStorage.storyid,\r\n            detail:[],\r\n            author:[],\r\n            like_users:[],\r\n            toggle:false,\r\n            userstarstory:[],\r\n            star:false\r\n        }\r\n    }\r\n    goback=()=>{\r\n        sessionStorage.storytype = this.state.detail.article_category;\r\n        history.go(-1);\r\n    }\r\n    componentDidMount(){\r\n        scrollTo(0, 0);\r\n        axios.post(\"/airbnb/storydetail\",{\r\n            id:this.state.storyid\r\n        }).then(res=>{\r\n            this.setState({\r\n                detail:res.data.result,\r\n                author:res.data.result.author_object\r\n            })\r\n            if(res.data.result.like_user){\r\n                this.setState({\r\n                    like_users:res.data.result.like_user\r\n                })\r\n                if(sessionStorage.userPhone){\r\n                    if(this.state.like_users.indexOf(sessionStorage.userPhone)!=-1){\r\n                        this.setState({\r\n                            toggle:true\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        if(sessionStorage.userPhone){\r\n            axios.get(\"/airbnb/userstars\",{\r\n                params:{\r\n                    phone:sessionStorage.userPhone\r\n                }\r\n            }).then(res=>{\r\n                // console.log(res);\r\n                this.setState({\r\n                    userstarstory:res.data.result.stories\r\n                })\r\n                var ind = res.data.result.stories.indexOf(sessionStorage.storyid);\r\n                if(ind!=-1){\r\n                    this.setState({\r\n                        star:true\r\n                    })\r\n                }\r\n            })\r\n        } \r\n    }\r\n    showXinyuan = () => {\r\n        const alertInstance = alert('收藏成功', '是否前往心愿单', [\r\n          { text: '继续浏览', onPress: () => console.log(''), style: 'default' },\r\n          { text: '查看心愿', onPress: () => this.goXinyuan() },\r\n        ]);\r\n    }\r\n    goXinyuan=()=>{\r\n        sessionStorage.xunyuansub = 1;\r\n        history.push(\"/index/xinyuandan\");\r\n    }\r\n    likeStory=(id,count)=>{\r\n        if(sessionStorage.userPhone){\r\n            this.state.like_users.push(sessionStorage.userPhone);\r\n            this.setState({\r\n                like_users:this.state.like_users\r\n            })\r\n            axios.post(\"/airbnb/likestory\",{\r\n                id:id,\r\n                phoneArr:this.state.like_users,\r\n                count:++count\r\n            }).then(res=>{\r\n                this.setState({\r\n                    toggle:true\r\n                })\r\n            })\r\n        }else{\r\n            showAlert();\r\n        }\r\n    }\r\n    cancelLikeStory=(id,count)=>{\r\n        var arr = this.state.like_users;\r\n        var ind = arr.indexOf(sessionStorage.userPhone);\r\n        arr.splice(ind,1);\r\n        \r\n        axios.post(\"/airbnb/cancellikestory\",{\r\n            id:id,\r\n            phoneArr:arr,\r\n            count:--count\r\n        }).then(res=>{\r\n            this.setState({\r\n                toggle:false\r\n            })\r\n        })\r\n    }\r\n    starStory=id=>{\r\n        if(sessionStorage.userPhone){\r\n            var stories = this.state.userstarstory;\r\n            stories.push(id);\r\n            axios.post(\"/airbnb/starstory\",{\r\n                phone:sessionStorage.userPhone,\r\n                storyArr:stories\r\n            }).then(res=>{\r\n                this.setState({\r\n                    star:true\r\n                });\r\n                this.showXinyuan();\r\n            })\r\n        }else{\r\n            showAlert();\r\n        }\r\n    }\r\n    cancelStarStory=id=>{\r\n        var stories = this.state.userstarstory;\r\n        var ind = stories.indexOf(id);\r\n        stories.splice(ind,1);\r\n        axios.post(\"/airbnb/starstory\",{\r\n            phone:sessionStorage.userPhone,\r\n            storyArr:stories\r\n        }).then(res=>{\r\n            this.setState({\r\n                star:false\r\n            })\r\n        })\r\n    }\r\n    render(){\r\n        const {\r\n            detail,\r\n            author,\r\n            toggle,\r\n            star\r\n        } = this.state;\r\n        return(\r\n            <div className=\"story_detail\">\r\n                <div className=\"story_hd\">\r\n                    <i className=\"iconfont icon-back\" onClick={this.goback}></i>\r\n                </div>\r\n                <div className=\"story_bd\">\r\n                    <div className=\"story_msg\">\r\n                        <img src={author.picture_url&&\r\n                            author.picture_url.substring(0,author.picture_url.indexOf(\"?\"))\r\n                        } alt=\"\"/>\r\n                        <div className=\"comment_user\">\r\n                            <h5>{author.first_name}</h5>\r\n                            <span>{detail.localized_article_location}</span>\r\n                            <span>{detail.published_at_human_readable}</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"story_content\">\r\n                        <img src={detail.cover_image_url&&\r\n                            detail.cover_image_url.substring(0,detail.cover_image_url.indexOf(\"?\"))\r\n                        } alt=\"\"/>\r\n                        <h2>{detail.title}</h2>\r\n                        <p>{detail.email_subtitle}</p>\r\n                        {/* <span id=\"changecount\">{detail.like_count}人已赞</span> */}\r\n                    </div>\r\n                    <div className=\"story_menu\">\r\n                        <div onClick={toggle?()=>this.cancelLikeStory(detail._id,detail.like_count):()=>this.likeStory(detail._id,detail.like_count)}\r\n                            style={{background:toggle?\"rgb(255, 90, 95, 0.8)\":\"\"}}>\r\n                            <i style={{color:toggle?\"#fff\":\"\"}} className=\"iconfont icon-dianzan\"></i>\r\n                        </div>\r\n                        <div onClick={star?()=>this.cancelStarStory(detail._id):()=>this.starStory(detail._id)}\r\n                            style={{background:star?\"rgb(255, 90, 95, 0.8)\":\"\"}}>\r\n                            <i style={{color:star?\"#fff\":\"\"}} className=\"iconfont icon-heart2e\"></i>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"story_ft\">\r\n                        <h2>点赞</h2>\r\n                        <h2>收藏</h2>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}","import {createHashHistory} from \"history\";\r\n\r\nconst history = new createHashHistory();\r\n\r\nexport {history};","\r\n\r\n\r\nimport axios from \"axios\";\r\n\r\n// axios.defaults.baseURL = \"http://localhost:2019/\";\r\naxios.defaults.baseURL = \"https://arthasic.top:6918\";\r\n\r\n\r\nlet token = \"\";\r\naxios.defaults.headers.common['token'] = token;    // token \r\naxios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\r\n\r\nimport {Toast,Modal } from \"antd-mobile\"\r\nimport {history} from \"./history\"\r\n\r\nconst alert = Modal.alert;\r\nconst showAlert = () => {\r\n    const alertInstance = alert('登录提示', '你确定是否前往登陆', [\r\n      { text: '我就看看', onPress: () => console.log('游客访问'), style: 'default' },\r\n      { text: '马上登录', onPress: () => history.push(\"/login\") },\r\n    ]);\r\n    setTimeout(() => {\r\n      // 可以调用close方法以在外部close\r\n      console.log('auto close');\r\n      alertInstance.close();\r\n    }, 500000);\r\n};\r\n\r\nexport function loadingToast(msg) {\r\n    // Toast.hide();\r\n    // Toast.loading(msg, 1, () => {\r\n    //   console.log('Load complete !!!');\r\n    // });\r\n}\r\n\r\nexport function failToast(msg) {\r\n    // Toast.hide();\r\n    // Toast.fail(msg, 1);\r\n}\r\n\r\nexport function showToast(msg) {\r\n    // Toast.hide();\r\n    // Toast.info(msg, 1);\r\n}\r\n\r\n// 拦截器配置    Interceptors \r\n// 发送请求之前 添加拦截器  \r\naxios.interceptors.request.use(function (config) {\r\n    // 发送之前做的事情 \r\n    // loadingToast(\"请求中\");\r\n    config.headers['token'] =  sessionStorage.token;\r\n    // console.log(config);\r\n\r\n    return config;\r\n}, function (error) {\r\n    // 发送失败 做的失败 \r\n    // failToast(\"请求失败\")\r\n    return Promise.reject(error);\r\n});\r\n\r\n// 响应数据 的拦截器 \r\naxios.interceptors.response.use(function (response) {\r\n    // 成功接收到数据 \r\n    // console.log(response);\r\n    setTimeout(()=>{\r\n        showToast(response.data.msg);\r\n        if(response.data.code==500){\r\n            // showAlert();\r\n        }\r\n    },500)\r\n    return response;\r\n}, function (error) {\r\n    // failToast(\"响应失败\");\r\n    // 无法接收到数据  \r\n    return Promise.reject(error);\r\n});\r\n\r\n\r\nexport  {axios};\r\n\r\n","import {observable, action} from \"mobx\";\r\n\r\nclass Msgtoggle {\r\n    @observable msgtoggle = false;\r\n\r\n    @action msgRead=()=>{\r\n        this.msgtoggle = false;\r\n    }\r\n\r\n    @action msgSend=()=>{\r\n        this.msgtoggle = true;\r\n    }\r\n}\r\n\r\nexport default new Msgtoggle();"],"sourceRoot":""}