{"version":3,"sources":["scripts/views/houses/index.js","utils/history.js","utils/axios.js"],"names":["Foot","LazyLoad","alert","Modal","Houses","scroll","p","t","window","addEventListener","document","documentElement","scrollTop","body","setState","toggle","setTimeout","chosen","tag","id","brr","state","preview_tags","forEach","i","push","txt","axios","post","city","then","res","arr","data","result","item","j","itag","crr","a","k","name","b","l","indexOf","length","nohouses","houses","goback","history","gotoDetail","sessionStorage","houseid","showModal","modal","toSearch","this","scrollTo","className","visible","transparent","maskClosable","title","footer","text","onPress","wrapProps","onTouchStart","onWrapTouchStart","afterClose","onClick","style","top","map","key","display","house","src","picture_url","alt","user","kicker_content","messages","m","price","location_context","display_name","Component","createHashHistory","defaults","baseURL","headers","common","interceptors","request","use","config","token","error","Promise","reject","response","msg","code"],"mappings":"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","file":"static/js/19.99cd99ea.chunk.js","sourcesContent":["import \"./index.scss\";\r\nimport LazyLoad from \"&/lazyload\";\r\nconst Foot = LazyLoad(() => import(\"~/Foot\"));\r\nimport { axios } from \"&/axios\";\r\nimport { history } from \"&/history\";\r\nconst alert = Modal.alert;\r\nimport { Modal } from 'antd-mobile';\r\n\r\nexport default class Houses extends Component {\r\n    constructor() {\r\n        super();\r\n        this.state = {\r\n            city: \"\",\r\n            preview_tags: [\r\n                { txt: \"超赞房东\", toggle: true },\r\n                { txt: \"可以做饭\", toggle: false },\r\n                { txt: \"近地铁站\", toggle: false },\r\n                { txt: \"高性价比\", toggle: false },\r\n                { txt: \"自助入住\", toggle: false },              \r\n            ],\r\n            houses: [],\r\n            toggle: true,\r\n            nohouses: false,\r\n            modal: false\r\n        }\r\n    }\r\n    scroll=()=>{\r\n        var p=0,t=20; \r\n        window.addEventListener('scroll',()=>{  \r\n            p = document.documentElement.scrollTop || document.body.scrollTop;\r\n            if(t<=p){//下滚  \r\n                this.setState({\r\n                    toggle: false\r\n                })\r\n            }  \r\n            else{//上滚   \r\n                this.setState({\r\n                    toggle: true\r\n                })\r\n            }  \r\n            setTimeout(()=>{\r\n                t = p;\r\n            },0);         \r\n        });\r\n    }\r\n    componentWillMount() {\r\n        this.setState({\r\n            city: sessionStorage.city\r\n        });\r\n        this.scroll();\r\n    }\r\n    componentDidMount() {\r\n        scrollTo(0, 0); \r\n        axios.post(\"/airbnb/house\", {\r\n            city: this.state.city\r\n        }).then(res => {\r\n            if(res.data.result.length){\r\n                var arr = [];\r\n                res.data.result.forEach((item, i) => {\r\n                    item.preview_tags.forEach((tag, j) => {\r\n                        if (tag.name.indexOf(\"超赞房东\") != -1) {\r\n                            arr.push(item);\r\n                        }\r\n                    })\r\n                })\r\n                this.setState({\r\n                    houses: arr\r\n                });\r\n            }else{\r\n                this.showModal();\r\n            }\r\n        })\r\n    }\r\n    chosen = (tag, id) => {\r\n        var brr= [];\r\n        this.state.preview_tags.forEach((t, i) => {\r\n            if (i == id) {\r\n                t.toggle = !t.toggle;\r\n            }\r\n            if(t.toggle == true){\r\n                brr.push(t.txt);\r\n            }\r\n        })\r\n        axios.post(\"/airbnb/house\", {\r\n            city: this.state.city\r\n        }).then(res => {\r\n            var arr = [];\r\n            res.data.result.forEach((item, j) => {\r\n                var itag = [];\r\n                var crr = [];\r\n                item.preview_tags.forEach((a, k) => {\r\n                    if(k > 0){\r\n                        itag.push(a.name);\r\n                    }\r\n                })\r\n                brr.forEach((b, l)=>{\r\n                    if(itag.indexOf(b) > -1){\r\n                        crr.push(b);\r\n                    }\r\n                })\r\n                if(crr.length == brr.length){\r\n                    arr.push(item);\r\n                }\r\n            })\r\n            if(!arr.length){\r\n                this.setState({\r\n                    nohouses: true\r\n                })\r\n            }else{\r\n                this.setState({\r\n                    nohouses: false\r\n                })\r\n            }\r\n            this.setState({\r\n                houses: arr\r\n            });\r\n        })\r\n    }\r\n    goback = () => {\r\n        history.push(\"/index/tansuo\");\r\n    }\r\n    gotoDetail = id => {\r\n        sessionStorage.houseid = id;\r\n        history.push(\"/housedetail\");\r\n    }\r\n    showModal = () =>{\r\n        this.setState({\r\n            modal: true\r\n        })\r\n    }\r\n    toSearch = () =>{\r\n        history.push(\"/search\");\r\n    }\r\n    render() {\r\n        const {\r\n            city,\r\n            preview_tags,\r\n            houses,\r\n            toggle,\r\n            nohouses\r\n        } = this.state;\r\n        return (\r\n            <div className=\"houses_page\">\r\n                <Modal\r\n                    visible={this.state.modal}\r\n                    transparent\r\n                    maskClosable={false}\r\n                    title=\"找不到想要的住宿体验\"\r\n                    footer={[{ text: '返回搜索页', onPress: () => this.toSearch()}]}\r\n                    wrapProps={{ onTouchStart: this.onWrapTouchStart }}\r\n                    afterClose={() => { alert('afterClose'); }}\r\n                >\r\n                </Modal>\r\n                <div className=\"city_title\">\r\n                    <div className=\"wrapper\">\r\n                        <i onClick={this.goback} className=\"iconfont icon-back\"></i>\r\n                        <span>{city}</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"preview_tags\" style={{top:toggle?\"1rem\":\"0\"}}>\r\n                    <div className=\"wrapper\">\r\n                        <ul>\r\n                            {\r\n                                preview_tags.map((tag, i) => {\r\n                                    return <li className={tag.toggle ? \"on\" : \"\"} key={i} onClick={() => this.chosen(tag, i)}>{tag.txt}</li>\r\n                                })\r\n                            }\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <div className=\"city_houses\" style={{display:nohouses?\"\":\"none\"}}>\r\n                    <h2>找不到满足条件的住宿体验</h2>\r\n                </div>\r\n                <div className=\"city_houses\" id=\"house\">\r\n                    <div className=\"wrapper\">\r\n                        {\r\n                            houses.map((house, i) => {\r\n                                return (\r\n                                    <div key={i} onClick={() => this.gotoDetail(house.id)} className=\"one_houses\">\r\n                                        <img className=\"house_picture\" src={house.picture_url} alt=\"\" />\r\n                                        <div className=\"house_txt\">\r\n                                            <img className=\"user_picture\" src={house.user.picture_url} alt=\"\" />\r\n                                            <div className=\"house_body\">\r\n                                                <p className=\"kicker_content\">\r\n                                                    {\r\n                                                        house.kicker_content.messages.map((m, j) => {\r\n                                                            return (\r\n                                                                <span key={j}>{m}</span>\r\n                                                            )\r\n                                                        })\r\n                                                    }\r\n                                                </p>\r\n                                                <h2>{house.name}</h2>\r\n                                                <ul className=\"house_tags\">\r\n                                                    {\r\n                                                        house.preview_tags.map((t, k) => {\r\n                                                            return (\r\n                                                                <li className={k == 0 ? \"first\" : \"\" || k == 1 ? \"second\" : \"\"} key={k}>{t.name}</li>\r\n                                                            )\r\n                                                        })\r\n                                                    }\r\n                                                </ul>\r\n                                            </div>\r\n                                            <div className=\"house_foot\">\r\n                                                <div className=\"house_footer\">\r\n                                                    <span><b>{house.price}</b>每晚</span>\r\n                                                    <span>{house.location_context&&\r\n                                                        house.location_context.display_name}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            })\r\n                        }\r\n                    </div>\r\n                </div>\r\n\r\n                <Foot></Foot>\r\n            </div>\r\n        )\r\n    }\r\n}","import {createHashHistory} from \"history\";\r\n\r\nconst history = new createHashHistory();\r\n\r\nexport {history};","\r\n\r\n\r\nimport axios from \"axios\";\r\n\r\n// axios.defaults.baseURL = \"http://localhost:2019/\";\r\naxios.defaults.baseURL = \"https://arthasic.top:6918\";\r\n\r\n\r\nlet token = \"\";\r\naxios.defaults.headers.common['token'] = token;    // token \r\naxios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\r\n\r\nimport {Toast,Modal } from \"antd-mobile\"\r\nimport {history} from \"./history\"\r\n\r\nconst alert = Modal.alert;\r\nconst showAlert = () => {\r\n    const alertInstance = alert('登录提示', '你确定是否前往登陆', [\r\n      { text: '我就看看', onPress: () => console.log('游客访问'), style: 'default' },\r\n      { text: '马上登录', onPress: () => history.push(\"/login\") },\r\n    ]);\r\n    setTimeout(() => {\r\n      // 可以调用close方法以在外部close\r\n      console.log('auto close');\r\n      alertInstance.close();\r\n    }, 500000);\r\n};\r\n\r\nexport function loadingToast(msg) {\r\n    // Toast.hide();\r\n    // Toast.loading(msg, 1, () => {\r\n    //   console.log('Load complete !!!');\r\n    // });\r\n}\r\n\r\nexport function failToast(msg) {\r\n    // Toast.hide();\r\n    // Toast.fail(msg, 1);\r\n}\r\n\r\nexport function showToast(msg) {\r\n    // Toast.hide();\r\n    // Toast.info(msg, 1);\r\n}\r\n\r\n// 拦截器配置    Interceptors \r\n// 发送请求之前 添加拦截器  \r\naxios.interceptors.request.use(function (config) {\r\n    // 发送之前做的事情 \r\n    // loadingToast(\"请求中\");\r\n    config.headers['token'] =  sessionStorage.token;\r\n    // console.log(config);\r\n\r\n    return config;\r\n}, function (error) {\r\n    // 发送失败 做的失败 \r\n    // failToast(\"请求失败\")\r\n    return Promise.reject(error);\r\n});\r\n\r\n// 响应数据 的拦截器 \r\naxios.interceptors.response.use(function (response) {\r\n    // 成功接收到数据 \r\n    // console.log(response);\r\n    setTimeout(()=>{\r\n        showToast(response.data.msg);\r\n        if(response.data.code==500){\r\n            // showAlert();\r\n        }\r\n    },500)\r\n    return response;\r\n}, function (error) {\r\n    // failToast(\"响应失败\");\r\n    // 无法接收到数据  \r\n    return Promise.reject(error);\r\n});\r\n\r\n\r\nexport  {axios};\r\n\r\n"],"sourceRoot":""}